package textExcel;

public class FormulaCell extends RealCell {
	
	private Spreadsheet spread;
	
	public FormulaCell(String text, Location loc, Spreadsheet spread) {
		super(text, loc);
		this.spread = spread;
	}
		
	@Override
	public String abbreviatedCellText() {
		return String.format("%-10.10s", getDoubleValue());
	}

	@Override
	public String fullCellText() {
		return String.format("%s", super.fullCellText());
	}
	
	public double getSum(String cells) {            //Computes the ( SUM A4-A6 )
		
		String[] cellLocations = super.fullCellText().split("-");
		
		SpreadsheetLocation cell1 = new SpreadsheetLocation(cellLocations[0]);
		SpreadsheetLocation cell2 = new SpreadsheetLocation(cellLocations[1]);
		
		double ans = 0.0;

		for(int r = cell1.getRow(); r <= cell2.getRow(); r++) {
			for (int c = cell1.getCol(); c <= cell2.getCol(); c++) {
				SpreadsheetLocation newCell = new SpreadsheetLocation(r, c);
				ans += ((RealCell)spread.getCell(newCell)).getDoubleValue();			
			}
		}

		return ans;
	}
	
//	public double getAvg(String cells) {           //Computes the ( AVG A4-A6 )
//		
//		String[] cellLocations = super.fullCellText().split("-");
//		
//		SpreadsheetLocation loc1 = new SpreadsheetLocation(cellLocations[0]);
//		SpreadsheetLocation loc2 = new SpreadsheetLocation(cellLocations[1]);
//
//
//		
//	}
	
	public double getDoubleValue() {
		
		String[] formula = super.fullCellText().split(" ");
		int forLen = formula.length;
		double ans = 0.0;
 	
		for(int j = 1; j < forLen; j = j+2) {
			if(formula[j].toUpperCase().charAt(0) >= 65 && formula[j].toUpperCase().charAt(0) <= 90) {
				SpreadsheetLocation loc = new SpreadsheetLocation(formula[j]);
				double a = ((RealCell)spread.getCell(loc)).getDoubleValue();
				formula[j] = Double.toString(a);
			}
		}
		
		if (formula[3].equals("SUM")) {
			
			ans += getSum(formula[2]);
			
		} else if (formula[1].equals("AVG")) {
			
//			ans += getAvg(formula[2]);
			
		}

		for(int i = 2; i < forLen-2; i = i+2) {
			if(formula[i].equals("+")){
				ans += Double.parseDouble(formula[i - 1]) + Double.parseDouble(formula[i + 1]);
			} else if(formula[i].equals("-")){
				ans += Double.parseDouble(formula[i - 1]) - Double.parseDouble(formula[i + 1]);
			} else if(formula[i].equals("*")){
				ans += Double.parseDouble(formula[i - 1]) * Double.parseDouble(formula[i + 1]);
			} else if(formula[i].equals("/")){
				ans += Double.parseDouble(formula[i - 1]) / Double.parseDouble(formula[i + 1]);
			}
		}
		
		return ans ;
	}
	
}
